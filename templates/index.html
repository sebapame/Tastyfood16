<!DOCTYPE html>
<html>
<head>
    <title>Estacionamiento Profesional</title>
    <style>
        .logo-container { display: flex; align-items: center; gap: 20px; margin: 20px; }
        .logo-container img { height: 100px; }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="/static/logo.jpg" alt="Logo">
        <h1>Estacionamiento Profesional</h1>
    </div>

    {% if mensaje %}
        <p style="color: red;">{{ mensaje }}</p>
    {% endif %}

    <form method="POST">
        <label>Patente:</label>
        <input type="text" name="patente" required maxlength="10"><br><br>

        {% if mostrar_monto %}
            <p><strong>Duraci√≥n:</strong> {{ minutos }} minutos</p>
            <p><strong>Monto a pagar:</strong> ${{ monto }}</p>
            <label>Medio de Pago:</label>
            <select name="medio_pago" required>
                <option value="">--Seleccione--</option>
                <option value="Efectivo">Efectivo</option>
                <option value="D√©bito">D√©bito</option>
                <option value="Cr√©dito">Cr√©dito</option>
                <option value="Prepago">Prepago</option>
            </select><br><br>
        {% else %}
            <label>Medio de Pago (solo si es salida):</label>
            <select name="medio_pago">
                <option value="">--Seleccione--</option>
                <option value="Efectivo">Efectivo</option>
                <option value="D√©bito">D√©bito</option>
                <option value="Cr√©dito">Cr√©dito</option>
                <option value="Prepago">Prepago</option>
            </select><br><br>
        {% endif %}

        <input type="submit" value="Registrar Entrada / Salida">
    </form>

    <hr>
    <h2>Filtrar por Fecha</h2>
    <form method="get">
        <label>Fecha:</label>
        <input type="date" name="fecha" value="{{ fecha }}">
        <input type="submit" value="Filtrar">
        <a href="/exportar?fecha={{ fecha }}">üì• Exportar Excel</a>
    </form>

    <h2>Resumen de Pagos del {{ fecha }}</h2>
    <ul>
        <li>Efectivo: ${{ "{:,}".format(totales.get('Efectivo', 0)) }}</li>
        <li>D√©bito: ${{ "{:,}".format(totales.get('D√©bito', 0)) }}</li>
        <li>Cr√©dito: ${{ "{:,}".format(totales.get('Cr√©dito', 0)) }}</li>
        <li>Prepago: ${{ "{:,}".format(totales.get('Prepago', 0)) }}</li>
        <li><strong>Total General:</strong> ${{ "{:,}".format(total_general) }}</li>
    </ul>

    <h2>Registros del {{ fecha }}</h2>
    <table border="1">
        <tr>
            <th>ID</th>
            <th>Patente</th>
            <th>Ingreso</th>
            <th>Salida</th>
            <th>Monto</th>
            <th>Medio de Pago</th>
            <th>Acciones</th>
        </tr>
        {% for r in registros %}
        <tr>
            <td>{{ r[0] }}</td>
            <td>{{ r[1] }}</td>
            <td>{{ r[2] }}</td>
            <td>{{ r[3] if r[3] else '-' }}</td>
            <td>{{ "$" + "{:,}".format(r[4]) if r[4] else '-' }}</td>
            <td>{{ r[5] if r[5] else '-' }}</td>
            <td>
                <a href="/editar/{{ r[0] }}">‚úèÔ∏è Editar</a> |
                <a href="/eliminar/{{ r[0] }}?fecha={{ fecha }}" onclick="return confirm('¬øEliminar este registro?');">üóëÔ∏è Eliminar</a>
            </td>
        </tr>
        {% endfor %}
    </table>

{% if mostrar_monto and datos_salida %}
<div id="modalSalida" style="
    position: fixed;
    top: 30%%;
    left: 50%%;
    transform: translate(-50%%, -50%%);
    background: white;
    border: 2px solid #444;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1000;
">
    <h3>Auto en salida</h3>
    <p><strong>Patente:</strong> {{ datos_salida.patente }}</p>
    <p><strong>Minutos:</strong> {{ datos_salida.minutos }}</p>
    <p><strong>Monto:</strong> ${{ datos_salida.monto }}</p>
    <p><em>Seleccione el m√©todo de pago para confirmar.</em></p>
    <button onclick="document.getElementById('modalSalida').style.display='none'">Cerrar</button>
</div>
<div style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%%;
    height: 100%%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
" onclick="document.getElementById('modalSalida').style.display='none'"></div>
{% endif %}

</body>
</html>
